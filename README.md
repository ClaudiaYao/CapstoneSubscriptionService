## Capstone Playlist Service

### How to run the system

First, start the Colima by typing "colima start" in command line

1. type **make tools** to install the necessary tools, such as Goose and sqlc

Note: Goose is used to manage sql migration (including the creation of database tables),
sqlc is used to generate sql queries and database related code automatically.
the code generated by sqlc is put under resources/database/sqlc/internal

2. type **make up_build** to build the application and run docker-compose.yml to load all
   the dependencies
   Note: If local application has not any change, just skip this step and go to the next step

3. type **make migrateup** to create database tables.
   > Note: for this step, if you meet permission or authentication errors, check in terminal window as below steps

- type "sudo lsof -i tcp:5432"
- type "sudo kill -9 <pid-number>"
- Then type "make migrateup" again

4. type **make copy_data** to copy sample data to playlist-postgres container.
   When psql command prompt shows, type **"\i copy_data_to_postgres.sql"**

5. Open postman, and try to test the micro-service

   - Get, http://localhost, return a welcome message
   - Get, http://localhost/playlists, return all the playlists from the sample data
   - Get, http://localhost/playlists/{id}, return one playlist with the specified id.
   - Get, http://localhost/playlists/category/{categoryCode}, return one playlist with the specified
     category code.
   - Post http://localhost/playlist/new, pass the JSON file as body (Not finish yet)

6. type **make down** to stop the system.

# Other usage:

### Generate Data

type **make generate_data** to generate a new batch of sample data, which will override the
original sample data.

### Use sqlc to generate SQL Queries

This task is not done automatically. Just follow these steps:

- Change work directory to resouces/database/sqlc
- Add your query to query.sql
- type "sqlc generate"

> You will see the automatically generated files under resources/database/sqlc/internal. Copy the code snippet to the .go files when you need them.

> You might refer to [sqlc documentation] (https://docs.sqlc.dev/en/stable/) for more information.

### Note

after updating to the colima,
volume of the postgresql is not supported, so
remove the following two lines from the docker-compose.yml

    volumes:
      - ./db-data/postgres/:/var/lib/postgresql/data/
